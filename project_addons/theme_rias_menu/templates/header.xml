<?xml version="1.0" encoding="utf-8" ?>
<odoo>

    <template id="snippet_cover_lasrias_menu" inherit_id="theme_rias.snippet_cover_lasrias" name="Snippet LasRias Menu">
        <xpath expr="//section/div[hasclass('container')]/div[hasclass('container')]" position="before">
            <t t-call="theme_rias_menu.snippet_features_lasrias_menu"/>
        </xpath>
    </template>

    <template id="website_submenu" name="Submenu dynamic" inherit_id="website.submenu">
        <!-- Control of user access to the website menu -->
        <xpath expr="//li[1]" position="attributes">
            <attribute name="t-if">
                submenu.top_menu_retailers and submenu.is_visible and submenu.website_published and not submenu.child_id.filtered(lambda menu: menu.is_visible) and ((
                    request.env.user.has_group('base.group_public') and submenu.for_customers
                ) or (
                    request.env.user.has_group('sale.group_show_price_subtotal') and submenu.for_retailers
                )) and not submenu.dynamic_cat_menu
            </attribute>
        </xpath>
        <xpath expr="//li[2]" position="attributes">
            <attribute name="t-if">
                submenu.top_menu_retailers and submenu.child_id.filtered(lambda menu: menu.is_visible) and submenu.website_published and ((
                    request.env.user.has_group('base.group_public') and submenu.for_customers
                ) or (
                    request.env.user.has_group('sale.group_show_price_subtotal') and submenu.for_retailers
                )) and not submenu.dynamic_cat_menu
            </attribute>
        </xpath>

        <!-- Add dynamic category menu -->
        <xpath expr="//li[2]" position="after">
            <li t-if="submenu.top_menu_retailers and submenu.dynamic_cat_menu and submenu.is_visible and submenu.website_published
                    and ((request.env.user.has_group('base.group_public') and submenu.for_customers)
                    or (request.env.user.has_group('sale.group_show_price_subtotal') and submenu.for_retailers))"
                    class="dropdown cat_dynamic_menu" >
                <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                    <span t-field="submenu.name"/> <span class="caret" t-ignore="true"/>
                </a>
                <t t-set="categories" t-value="website.dynamic_category_list()"/>
                <div t-if="categories" class="dropdown-menu dynamic-cat-menu">
                    <t t-foreach="categories" t-as="cat">
                        <div t-if="not cat.parent_id" class="first-level">
                            <div class="first-level-wp">
                                <a t-att-href="'/catalogue/category/%s' %cat.slug if cat.slug else '/catalogue/category/%s' %slug(cat)"
                                   t-field="cat.name" />
                            </div>
                            <div class="first-level-inner" t-if="cat.child_id">
                                <ul>
                                    <t t-foreach="cat.child_id" t-as="sub_cat">
                                        <li class="second-level">
                                            <a t-att-href="'/catalogue/category/%s' %sub_cat.slug if sub_cat.slug else '/catalogue/category/%s' %slug(sub_cat)"
                                               t-field="sub_cat.name"/>
                                            <div class="second-level-inner" t-if="sub_cat.child_id">
                                                <ul>
                                                    <t t-foreach="sub_cat.child_id" t-as="sub_2_cat">
                                                        <li class="third-level">
                                                            <a t-att-href="'/catalogue/category/%s' %sub_2_cat.slug if sub_2_cat.slug else '/catalogue/category/%s' %slug(sub_2_cat)"
                                                               t-field="sub_2_cat.name"/>
                                                        </li>
                                                    </t>
                                                </ul>
                                            </div>
                                        </li>
                                    </t>
                                </ul>
                            </div>
                        </div>
                    </t>
                </div>
            </li>
        </xpath>
    </template>

</odoo>