<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <delete id="stock_move_selection_wzd.action_moves_assign_batch" model="ir.actions.server"/>
    <!--record id="action_moves_assign_batch" model="ir.actions.server">
        <field name="name">Asignar carta de porte</field>
        <field name="model_id" ref="stock.model_stock_move"/>
        <field name="binding_model_id" ref="stock.model_stock_move"/>
        <field name="state">code</field>
        <field name="code">records.move_assign_batch_delivery()</field>
    </record-->
    <delete id="stock_move_selection_wzd.action_moves_DEassign_batch" model="ir.actions.server"/>
    <!--record id="action_moves_DEassign_batch" model="ir.actions.server">
        <field name="name">Desasignar carta de porte</field>
        <field name="model_id" ref="stock.model_stock_move"/>
        <field name="binding_model_id" ref="stock.model_stock_move"/>
        <field name="state">code</field>
        <field name="code">records.move_desassign_batch_delivery()</field>
    </record-->

    <record id="view_picking_type_form" model="ir.ui.view">
        <field name="name">stock.picking.type.form.grouo</field>
        <field name="model">stock.picking.type</field>
        <field name="inherit_id" ref="stock.view_picking_type_form"/>
        <field name="type">form</field>
        <field name="arch" type="xml">
            <field name="code" position="after">
                <field name="group_code"/>
            </field>
        </field>
    </record>

    <record id="view_move_form_wzd_change_quant" model="ir.ui.view">
        <field name="name">stock.move.change_quant_wzd</field>
        <field name="inherit_id" ref="stock.view_move_form"/>
        <field name="model">stock.move</field>
        <field name="arch" type="xml">
            <field name="state" position="before">
                    <button name="button_reasignar_origen_wzd"
                            attrs="{'invisible': [('state', 'not in', ('confirmed', 'assigned', 'partially_available'))]}"
                            string="(RE) Asignar origen" type="object" class="oe_highlight" groups="base.group_user"/>
            </field>
            <field name="picking_id" position="after">
                <field name="batch_delivery_id"/>
            </field>
        </field>
    </record>

     <record id="view_move_line_tree_sel" model="ir.ui.view">
        <field name="name">stock.move.tree.sel</field>
        <field name="model">stock.move</field>
        <field name="arch" type="xml">
            <tree decoration-muted="state not in ('assigned', 'partially_available')"
                  decoration-success="state in ('assigned', 'partially_available') and (
                                        (group_code == 'outgoing' and batch_delivery_id and shipping_type and result_package_id) or
                                        (group_code != 'outgoing' and batch_picking_id) or
                                        (group_code in ('location','picking') and sga_state in ('PE', 'SR', 'PS'))
                                        )"

                  decoration-warning="state in ('assigned', 'partially_available') and
                    ((group_code != 'outgoing' and not batch_picking_id) or
                    (group_code == 'outgoing' and (not shipping_type or not result_package_id)) or
                    (group_code in ('location','picking') and sga_state not in ('PE', 'SR', 'PS')))"

                  string="Movimientos"
                  edit="1"
                  create="0"
                  default_order="date">

                <field name="shipping_type" invisible="context.get('group_code', False) in ('reposition', 'incoming', 'location')"/>
                <field name="delivery_route_path_id" invisible="not context.get('group_code', False) in ('outgoing', 'dropship')"/>
                <field name="carrier_id" invisible="not context.get('group_code', False) in ('outgoing', 'dropship')"/>
                <field name="batch_delivery_id" invisible="not context.get('group_code', False) in ('outgoing', 'dropship')"/>
                 <button name="action_add_to_batch_delivery"
                        string="Enviar"
                        type="object"
                        context="{'object': 'move'}"
                        icon="fa-truck"
                        attrs="{'invisible': ['|','|',('group_code', 'not in', ('outgoing', 'dropship')), ('result_package_id', '!=', False), ('state', 'not in', ('assigned', 'partially_available'))]}"
                        />
                <field name="batch_id"/>
                <field name="batch_picking_id" invisible="1"/>
                <field name="draft_batch_picking_id" invisible="1"/>
                <button name="action_add_to_batch_picking"
                        string="Enviar"
                        type="object"
                        context="{'model': 'move'}"
                        icon="fa-tasks"
                        attrs="{'invisible': ['|', ('group_code', 'not in', ('picking', 'location', 'reposition')), ('state', 'not in', ('assigned', 'partially_available'))]}"
                        />
                <!--button name="action_set_envio_sga"
                        string="Cancelar envío a SGA"
                        type="object"
                        context="{'object': 'move'}"
                        icon="fa-volume-up"
                        attrs="{'invisible': ['|', '|', ('sga_integrated', '=', False), ('sga_state', '=', 'PE'), ('state', 'not in', ('assigned', 'partially_available'))]}"
                        />
                <button name="action_set_envio_sga"
                        string="Enviar a SGA"
                        type="object"
                        context="{'object': 'move'}"
                        icon="fa-volume-off"
                        attrs="{'invisible': ['|', '|', ('sga_integrated', '=', False), ('sga_state', '=', 'NE'), ('state', 'not in', ('assigned', 'partially_available'))]}"
                        /-->
                <field name="picking_id" invisible="1"/>
                <field name="sale_id" string="Venta" invisible="not context.get('group_code', False) in ('outgoing', 'picking')"/>
                <field name="purchase_id" string="Compra" invisible="not context.get('group_code', False) in ('incoming', 'location')"/>

                <field name="id" groups="base.group_no_one" invisible="1"/>
                <field name="picking_type_id" invisible="1"/>
                <field name="sga_integrated" invisible="1"/>
                <field name="code" invisible="1"/>
                <field name="group_code" invisible="1"/>
                <field name="partner_id" />
                <field name="date" invisible="1" />
                <field name="campaign_id" invisible="1"/>
                <field name="date_expected" />
                <!--field name="reference" string="Reference"/-->
                <field name="product_id"/>
                <field name="location_id" invisible="context.get('group_code', False) in ('outgoing', 'incoming')"/>
                <field name="package_id" invisible="1"/>
                <field name="location_dest_id" invisible="not context.get('group_code', False) in ('picking', 'internal', 'location', 'reposition')"/>
                <field name="result_package_id" invisible="not context.get('group_code', False) in ('outgoing', 'other')"/>


                <button name="action_add_to_batch_delivery"
                        string="Enviar"
                        type="object"
                        context="{'object': 'package'}"
                        icon="fa-truck"
                        attrs="{'invisible': ['|','|',('result_package_id', '=', False), ('state', 'not in', ('assigned', 'partially_available'))]}"
                        />
                <button name="action_tree_manage_pack"
                        string="(Des) Empaquetar"
                        type="object"
                        icon="fa-dropbox"
                        attrs="{'invisible': ['|', '|',('batch_delivery_id', '!=', False), ('group_code', '!=', 'outgoing'), ('state', 'not in', ('assigned', 'partially_available'))]}"
                        />
                <field name="product_uom_qty" string="Quantity Ordered"/>
                <field name="state"/>
                <field name="sga_state" invisible="not context.get('group_code', False) in ('picking', 'internal', 'location', 'reposition')"/>
                <field name="company_id" invisible="1"/>
                <field name="move_dest_ids" widget="many2many_tags" invisible="context.get('group_code', False) in ('incoming', 'picking')"/>
                <!--field name="wh_state"/-->

            </tree>
        </field>
    </record>

     <record id="stock_move_view_sel_search" model="ir.ui.view">
        <field name="name">stock.move.search</field>
        <field name="model">stock.move</field>
        <field name="arch" type="xml">
            <search string="Stock Moves">
                <field name="picking_id" string="Reference"/>


                <field name="dunmy_picking_id" string="To assign ref."
                       context="{'picking': self, 'group_by': 'picking_id'}"
                       filter_domain="['|', ('picking_id', '=', self), ('picking_id','=', False)]"/>
                <field name="picking_type_id" string="Type"/>
                <field name="shipping_type" />
                <field name="delivery_route_path_id"/>
                <field name="sale_id" groups="stock.group_stock_multi_locations"/>
                <field name="package_id"/>
                <field name="result_package_id"/>


                <field name="product_id"/>
                <field name="location_id" groups="stock.group_stock_multi_locations"/>
                <field name="location_dest_id" groups="stock.group_stock_multi_locations"/>
                <field name="partner_id" groups="stock.group_stock_multi_locations"/>
                <field name="company_id"/>
                <field name="campaign_id"/>
                <field name="carrier_id"/>
                <field name="sga_integrated"/>

                <separator/>
                <filter name="late" string="Retrasados" domain="[('date_expected','&lt;', time.strftime('%%Y-%%m-%%d %%H:%%M:%%S'))]" help="Movimientos retrasados"/>
                <!--filter string="To SGA" name="sga" domain="[('state','in', ['assigned', 'partially_available'])]"/-->
                <filter string="Waiting" name="todo" domain="[('state','in', ['waiting', 'confirmed', 'partially_available'])]"/>
                <filter string="Reservado" name="ready" domain="[('state','in', ['assigned', 'partially_available'])]"/>
                <filter string="Hechos" name="done" domain="[('state','=','done')]"/>
                <filter string="No hechos" name="not_done" domain="[('state','not in',['done', 'draft'])]"/>
                <separator/>
                <filter string="SGA" name="sga_integrated" domain="[('sga_integrated','=', True)]"/>
                <separator/>
                <!--filter string="Urgente" name="urgent" domain="[('urgent','=', True)]"/-->
                <filter string="With pick" name="with_pick" domain="[('picking_id','!=', False)]"/>
                <filter string="To pick" name="without_pick" domain="[('picking_id','=', False)]"/>
                <separator/>
                <filter string="Campaña" name="with_campaign_id" domain="[('campaign_id','!=', False)]"/>
                <filter string="Normal" name="no_campaign_id" domain="[('campaign_id','=', False)]"/>
                <filter string="Devoluciones" name="returns" domain="[('origin_returned_move_id','!=',False)]"/>
                <separator/>
                <filter string="Picking" name="picking" domain="[('picking_type_id.group_code','=','picking')]"/>
                <filter string="Internal" name="internal" domain="[('picking_type_id.group_code','=','internal')]"/>
                <filter string="Incoming" name="incoming" domain="[('picking_type_id.group_code','=','incoming')]"/>
                <filter string="Outgoing" name="outgoing" domain="[('picking_type_id.group_code','=','outgoing')]"/>
                <filter string="Location" name="location" domain="[('picking_type_id.group_code','=','location')]"/>
                <filter string="Reposition" name="reposition" domain="[('picking_type_id.group_code','=','reposition')]"/>
                <filter string="Other" name="other" domain="[('picking_type_id.group_code','=','other')]"/>
                <separator/>
                <filter string="With package" name="with_package" domain="[('result_package_id','!=', False)]"/>
                <filter string="With no package" name="with_no_package" domain="[('result_package_id','=', False)]"/>
                <separator/>
                <filter string="Sin carta de porte" name="batch_picking_id_false" domain="[('picking_id.batch_picking_id','=', False)]"/>
                <filter string="Con carte de porte" name="batch_picking_id_true" domain="[('picking_id.batch_picking_id','=', True)]"/>
                <separator/>
                <filter string="Pasarán" name="pasaran_route" domain="[('shipping_type','=', 'pasaran')]"/>
                <filter string="Urgente" name="urgent_route" domain="[('shipping_type','=', 'urgent')]"/>
                <filter string="Ruta" name="route_route" domain="[('shipping_type','=', 'route')]"/>
                <separator/>
                <filter name="sga_integrated" string="SGA" domain="[('sga_integrated','=', True)]"/>
                <filter name="waiting" string="SGA. Enviado" domain="[('sga_state','=', 'PS')]"/>
                <filter name="error" string="SGA. Error" domain="[('sga_state','in', ['EI', 'EE'])]"/>
                <filter name="processed" string="SGA. Completado" domain="[('sga_state','=', 'MT')]"/>
                <group expand="0" string="Group By">
                    <filter string="Tipo de envío" name="by_shipping_type" domain="[]"  context="{'group_by':'shipping_type'}"/>
                    <filter string="Status" name="by_state" domain="[]"  context="{'group_by':'state'}"/>
                    <!--filter string="SGA status" name="by_wh_status" domain="[]"  context="{'group_by':'wh_state'}"/-->
                    <filter string="Partner" name="by_partner_id" domain="[]"  context="{'group_by':'partner_id'}"/>
                    <filter string="Dirección de entrega" name="by_shipping_partner_id" domain="[]"  context="{'group_by':'partner_id'}"/>
                    <filter string="Campaña" name="by_campaign_id" domain="[]"  context="{'group_by':'campaign_id'}"/>
                    <filter string="Sale order" name="by_sale_id" domain="[]"  context="{'group_by':'sale_id'}"/>
                    <filter string="Ruta de transporte" name="by_delivery_path_route_id" domain="[]"  context="{'group_by':'delivery_route_path_id'}"/>
                    <filter string="Forma de envío" name="by_carrier_id" domain="[]"  context="{'group_by':'carrier_id'}"/>
                    <filter string="Orden de compra" name="by_purchase_id" domain="[]"  context="{'group_by':'purchase_id'}"/>
                    <filter string="Origen" name="by_location_id" domain="[]"  context="{'group_by':'location_id'}"/>
                    <filter string="Destino" name="by_location_dest_id" domain="[]"  context="{'group_by':'location_dest_id'}"/>
                    <filter string="Compañia" name="by_company" domain="[]"  context="{'group_by':'company_id'}"/>
                    <filter string="Tipo de albarán" name="by_type" domain="[]"  context="{'group_by':'picking_type_id'}"/>
                    <filter string="Picking" name="by_picking" domain="[]"  context="{'group_by':'picking_id'}"/>
                    <filter string="Paquete" name="by_package" domain="[]"  context="{'group_by':'package_id'}"/>
                    <filter string="Dest. Paquete" name="by_dest_package" domain="[]"  context="{'group_by':'result_package_id'}"/>


                </group>
            </search>
        </field>
    </record>

    <record id="view_move_sel_kanban" model="ir.ui.view">
            <field name="name">stock.move.kanban</field>
            <field name="model">stock.move</field>
            <field name="arch" type="xml">
                <kanban class="o_kanban_mobile">
                    <field name="name"/>
                    <field name="product_id"/>
                    <field name="priority"/>
                    <field name="state"/>
                    <field name="show_details_visible"/>
                    <field name="shipping_type"/>
                    <field name="info_route_str"/>
                <field name="delivery_route_path_id" />
                <field name="carrier_id" />

                    <field name="sga_integrated" />

                    <templates>
                        <t t-name="kanban-box">
                            <div t-attf-class="oe_kanban_global_click">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <span t-if="record.sga_integrated.raw_value" class="badge">
                                            <i class="fa fa-fw fa-rss-square"/>
                                        </span>
                                        <strong class="o_kanban_record_title" invisible="1">
                                            <span><field name="name"/></span>
                                        </strong>
                                        <div t-if="record.picking_id.raw_value" class="oe_kanban_bottom_right">
                                            <button name="move_desel_assign_picking"
                                                string="Unlink picking"
                                                class="o_icon_button fa fa-sign-out"
                                                type="object" options="{&quot;warn&quot;: true}"/>
                                            <field name="picking_id"/>
                                        </div>
                                        <div t-if="!record.picking_id.raw_value" class="oe_kanban_bottom_right">
                                            <button name="move_sel_assign_picking"
                                                string="Assign picking"
                                                class="o_icon_button fa fa-sign-in"
                                                type="object" options="{&quot;warn&quot;: true}"/>
                                        </div>
                                    </div>
                                    <field name="state" widget="label_selection" options="{'classes': {'draft': 'default', 'cancel': 'danger', 'assigned': 'success', 'confirmed': 'default'}}"/>
                                    <span t-if="record.sga_integrated.raw_value">
                                        <field name="sga_state" widget="label_selection" />
                                    </span>
                                </div>
                                <div class="o_kanban_record_body">
                                    <div>
                                        <field name="product_id"/>
                                    </div>
                                     <div>
                                         <span><field name="info_route_str"/></span>
                                    </div>
                                </div>

                                <div class="o_kanban_record_bottom">
                                    <div class="oe_kanban_bottom_left">
                                        <button name="action_show_details" string="Register lots, packs, location"
                                                class="o_icon_button fa fa-list" type="object"
                                                attrs="{'invisible': [('show_details_visible', '=', False)]}" options='{"warn": true}'/>
                                         <span><field name="date_expected"/></span>
                                    </div>
                                    <div class="oe_kanban_bottom_right">
                                        <span><field name="product_uom_qty"/></span>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>


</odoo>



